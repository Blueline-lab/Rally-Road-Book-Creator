
<!--Mozilla Public License Version 2.0
Refer to : LICENCE
author : Blueline-Lab -->
<!DOCTYPE html>
<html lang="en">
<head>

</head>
<body>


<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>BluelineNav</title>

	<link rel="shortcut icon" type="image/x-icon" href="./Symbols/logo_blue.png" />

    <link rel="stylesheet" href="./leaflet/leaflet.css" />
    <script src="./leaflet/leaflet.js"></script>
    <script src="./leaflet/gpx.js"></script>


<style>
    #logo{width: 200px; height:200px}

    #canvasContainer{
        position: absolute; top: 302px; right: 301px; width: 605px; height: 300px;
        flex-direction: column-reverse; /* Alignement des canvas en dessous */
        margin: 0px;
        align-items: flex-start; /* Alignement à gauche */

    }
    canvas{
        border: 1px solid black;
    }
    .drag-el{
    position: sticky;
    width: 50px;
    height: 50px;
    }
    #svg_container{
    position: absolute;
    top: 0px;
    right: 0px;
    width: 292px;
    height: 1000px;
    border: 1px solid black;

    overflow-y: auto; /* Activer le défilement vertical si nécessaire */
    max-height: 1000px; /* Limiter la hauteur du conteneur pour activer le défilement */
    }


     #map{
    position: absolute;
    width: 628px;
    height: 800px;
    top: 0px;
    left: 0px;
    }

    @media print {
    #map, #svg_container{display: none;}
    }

    .eight h1 {
    text-align:center;

    text-transform:uppercase;
    font-size:26px; letter-spacing:1px;

    display: grid;
    grid-template-columns: 1fr auto 1fr;
    grid-template-rows: 16px 0;
    grid-gap: 22px;
    }

    .eight h1:after,.eight h1:before {
    content: " ";
    display: block;
    border-bottom: 2px solid #ccc;
    background-color:#f8f8f8;
    }

    .popup-container {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 999;
}

.popup-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: white;
  padding: 20px;
  border-radius: 5px;
  text-align: center;
}

.popup-content h2 {
  margin-top: 0;
}

.popup-content button {
  padding: 10px 20px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.popup-content button:hover {
  background-color: #0056b3;
}

#contact_m{font-size: 12px;}


.button-54 {
  font-family: "Open Sans", sans-serif;
  font-size: 13px;
  letter-spacing: 2px;
  text-decoration: none;
  text-transform: uppercase;
  color: #000;
  cursor: pointer;
  border: 3px solid;
  padding: 0.25em 0.5em;
  box-shadow: 1px 1px 0px 0px, 2px 2px 0px 0px, 3px 3px 0px 0px, 4px 4px 0px 0px, 5px 5px 0px 0px;
  position: relative;
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
}

.button-54:active {
  box-shadow: 0px 0px 0px 0px;
  top: 5px;
  left: 5px;
}

@media (min-width: 768px) {
  .button-54 {
    padding: 0.25em 0.75em;
  }
}

</style>
<div id="map"></div>
<div id="viewport" style=" border: 1px solid black; position: absolute; top: 0px; right: 294px; width: 610px; height: 300px;">
<img id="logo" src="./Symbols/logo.png" style="position: absolute; top: 0px; right: 220px; width: 200px; height: 200px">

<input type="text" id="name" name="name" style="position: absolute; top: 170px; right: 135px; width: 300px; height: 25px;"/>

<canvas id="c0" style="position: absolute; top: 146px; left: 0px; width: 80px; height: 152px;"></canvas>
<canvas id="c1" style="position: absolute; top: 146px; left: 0px; width: 80px; height: 50px;"></canvas>
<canvas id="c2" style="position: absolute; top: 196px; left: 0px; width: 80px; height: 50px;"></canvas>
<canvas id="c3" style="position: absolute; top: 248px; left: 0px; width: 80px; height: 50px;"></canvas>
<textarea id="story" name="story" rows="5" cols="33" style="position: absolute; bottom: 2px; right: 0px; width: 521px; height: 70px;">
</textarea>

</div>
<input type="file" id="fileInput" style="display: none;" accept=".gpx">

<div id="canvasContainer"></div>




<div id="svg_container">
<button class="button-54" id="offroad" style="positon: sticky;">Offroad</button>
<button class="button-54" id="track" style="positon: sticky;">Track</button>
<button class="button-54" id="trail" style="positon: sticky;">Trail</button>
<button class="button-54" id="road" style="positon: sticky;">Road</button>
<button class="button-54" id="hightway" style="positon: sticky;">Hightway</button>
<button class="button-54" id="import_gpx" onclick="chooseFile()" style="positon: sticky;">Import GPX</button>

<div class="eight">
  <h1>Tracks</h1>
</div>

<img id="offroad_" class="drag-el" src="./Symbols/TRACK/offroad.svg" draggable="true">
<img id="track_" class="drag-el" src="./Symbols/TRACK/track.svg" draggable="true">
<img id="trail_" class="drag-el" src="./Symbols/TRACK/trail.svg" draggable="true">
<img id="road_" class="drag-el" src="./Symbols/TRACK/road.svg" draggable="true">
<img id="highway_" class="drag-el" src="./Symbols/TRACK/highway.svg" draggable="true">

<img class="drag-el" src="./Symbols/TRACK/hp.png" draggable="true">
<img class="drag-el" src="./Symbols/TRACK/hp_.png" draggable="true">
<img class="drag-el" src="./Symbols/TRACK/piste_principale_s.png" draggable="true">
<img class="drag-el" src="./Symbols/TRACK/piste_s.png" draggable="true">
<img class="drag-el" src="./Symbols/TRACK/pp.png" draggable="true">
<img class="drag-el" src="./Symbols/TRACK/pp_para.png" draggable="true">
<img class="drag-el" src="./Symbols/TRACK/qt_pp.png" draggable="true">
<div class="eight">
  <h1>Frames</h1>
</div>

<div class="eight">
  <h1>Waypoints</h1>
</div>
<img class="drag-el" src="./Symbols/WAYPOINTS/C.png" draggable="true">
<img class="drag-el" src="./Symbols/WAYPOINTS/E.png" draggable="true">
<img class="drag-el" src="./Symbols/WAYPOINTS/M.png" draggable="true">
<img class="drag-el" src="./Symbols/WAYPOINTS/WAYPOINTNAVIGATION.svg" draggable="true">
<img class="drag-el" src="./Symbols/WAYPOINTS/WAYPOINTSAFETY.svg" draggable="true">
<img class="drag-el" src="./Symbols/WAYPOINTS/wpv.png" draggable="true">
<div class="eight">
  <h1>Cap</h1>
</div>
<img id="azimuth1" class="drag-el" src="./Symbols/DIRECTIONS/cap.png" draggable="true">
<img id="azimuthmoy" class="drag-el" src="./Symbols/DIRECTIONS/cap.png" draggable="true">
<img id="azimutha" class="drag-el" src="./Symbols/DIRECTIONS/cap.png" draggable="true">
<img id="azimuthc" class="drag-el" src="./Symbols/DIRECTIONS/cap.png" draggable="true">
<div class="eight">
  <h1>Safety</h1>
</div>
<img class="drag-el" src="./Symbols/SAFETY/DANGER_1.svg" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/DANGER_2.svg" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/DANGER_3.svg" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/DANGER_all.svg" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/global_danger3.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/l1.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/l2.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/l3.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/restricted.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/SLOW_DOWN.svg" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/slow_z.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/tsd_time.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/warning.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/5.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/10.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/15.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/25.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/30.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/35.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/40.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/45.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/50.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/55.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/60.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/65.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/70.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/75.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/80.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/85.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/90.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/95.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/100.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/110.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/120.png" draggable="true">

<img class="drag-el" src="./Symbols/SAFETY/5_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/10_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/15_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/25_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/30_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/35_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/40_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/45_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/50_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/55_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/60_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/65_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/70_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/75_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/80_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/85_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/90_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/95_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/100_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/110_.png" draggable="true">
<img class="drag-el" src="./Symbols/SAFETY/120_.png" draggable="true">
<div class="eight">

  <h1>Specificities</h1>
</div>
<img class="drag-el" src="./Symbols/SPECIFICITIES/aboveBridge.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/bump.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/cattleGateBarrier.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/compression.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/concrete.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/concreteInWater.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/dipHole.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/ditch.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/downHill.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/gateBarrier.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/gateBarrier2.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/leftOverCrest.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/narrow.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/rightOverCrest.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/stepUp.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/underBridge.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/upHill.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/waterCrossing.svg" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/sommet.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/50.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/100.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/150.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/200.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/250.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/300.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/350.png" draggable="true">
<img class="drag-el" src="./Symbols/SPECIFICITIES/400.png" draggable="true">
<div class="eight">
  <h1>Elements</h1>
</div>
<img class="drag-el" src="./Symbols/ELEMENTS/ANIMALS_INDIVIDUAL.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ANIMALS.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/AbandonedHouse.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ANTENA_MAST.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/Arbour.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BARBED_WIR_FENCE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BARREL.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BIG_BOWL_IN_DUNES.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BIVOUAC.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BROKEN_DUNE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BUILDINGS_INDIVIDUALS.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/BUMPY.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/CAIRN.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/CAMEL_GRASS.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/CEMETERY.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/CHURCH_MOSQUE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/Cross.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/DUNE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/DUNES-X.svg" draggable="tru)">
<img class="drag-el" src="./Symbols/ELEMENTS/DUNES.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ELECTRIC_LINE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ElectricLine.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/FENCE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/FORT.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/HIGH_VOLTAGE_TOWER.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/HOLE_COLLAPS.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/HOLE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/HOUSE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/KILOMETER_MARKER.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/Landmark.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/LARGE WADI.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/SMALL_WADI.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/LATERAL_INCLINATION.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/MONUMENT.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/MOUNTAIN_INDIVIDUAL.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/PALM_TREE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/PETRO_STATION.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/RAILROAD.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/RESTRICTED_AREA.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/RIVER.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ROCKS_INDIVIDUAL.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/Roots.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/SAND_PLAIN.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/SANDY WADI.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/SMALL_DUNE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/SMALL DUNES.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/Stump.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/TALL_GRASS.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/Tower.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/WATER_TANK.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/TREE_INDIVIDUAL.svg" draggable="tru)">
<img class="drag-el" src="./Symbols/ELEMENTS/TUNNEL.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/TWISTY.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/VEGETATION-1.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/VEGETATION.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/WATER_AREA.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/VILLAGE.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/WELL.svg" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ad.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/ag.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/betw.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/bivouac.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/canyon.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/cont.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/d.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/def.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/descente.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/dnt.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/e3.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/et.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/follow.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/fuel.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/fuel_95.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/fuel_diesel.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/fuel_95_red.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/g.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/grand.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/grand_p.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/green_tree.png" draggable="true">
<img class="drag-el" src="./Symbols/ELEMENTS/imp.png" draggable="true">

<div class="eight">
  <h1>Zones</h1>
  <img class="drag-el" src="./Symbols/ZONES/arrrival.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/CONTROL_ZONE_END.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/DEPARTURE_SELECTIVE_SECTION.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/PASSAGE_CONTROL.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/REFUELING_POINT.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/START_OF_NEUTRALISATION.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/FINISH_OF_NEUTRALISATION.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/TIME_CONTROL.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/START_OF_SERVICE_AREA.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/FINISH_OF_SERVICE_AREA.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/START.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/FINISH.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/START_ZONE_SPEED_LIMIT.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/SPEED_LIMIT_END_ZONE.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/STOP.svg" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/cp.png" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/fuel_zone.png" draggable="true">
  <img class="drag-el" src="./Symbols/ZONES/fuel_zone_.png" draggable="true">



</div>

<div class="eight">
  <h1>Direction</h1>
</div>
<img class="drag-el" src="./Symbols/DIRECTIONS/ALWAYS-144.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/AND.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/AT.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/BAD.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/BETWEEN.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/BIG.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/COLLAPSED.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/follow.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/get.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/GRAVEL.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/IMPERATIVE.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/INTO.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/keep.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/keep_left.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/keep_right.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/L_and_R.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/LESS_VISIBLE.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/MANY.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/MORE_VISIBLE.svg" draggable="tru)">
<img class="drag-el" src="./Symbols/DIRECTIONS/NARROW-155.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/NEXT-139.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/ON_THE_LEFT_ON_THE_RIGHT.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/QUIT_LEAVE.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/QUIT_LEAVE_MAIN_TRACK.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/VALLEY.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/REJOIN-159.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/RIGHT_AND_LEFT.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/ROUGH.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/SMALL.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/STONE_ROCK _N_TRACK.svg" draggable="true">
<img class="drag-el" src="./Symbols/DIRECTIONS/STON_ROCK_TRACK.svg" draggable="true">







<script>

window.onload = function() {
  document.getElementById('popup').style.display = 'block';
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
}





window.addEventListener('scroll', function () {
        var scrollTop = window.scrollY;
        document.getElementById('map').style.top = scrollTop + 'px';});

//window.addEventListener('scroll', function () {
       // var scrollTop = window.scrollY;
        //document.getElementById('svg_container').style.top = scrollTop + 'px';});

var points = [];
var line_type = "offroad"
var orientations = []
var groupes = []
var distance_totale = 0
var case_nb = 1
var fuel_wp = 0
var l_canvas = document.querySelectorAll('.dropzone');

var c_id_counter = 1


var ctx3 = null
var clicked_canvas = null
var x_clicked = null
var y_clicked = null
var azimuth1 = null
var azimuthmoy = null

var main_canvas = null
var entete = null


    function load_azimut_to_image(){
        //aimuth
        if (azimuth1 != null){
            document.getElementById('azimuth1').innerHTML = ""
            document.getElementById('azimuthmoy').innerHTML = ""};


        var azimuth = clicked_canvas.getAttribute("comment");

        var az_canvas1 = document.createElement("canvas");
        var ctx4 = az_canvas1.getContext("2d");
        ctx4.font = "160px Arial";
        ctx4.fillText(azimuth, 15, 130);
        ctx4.stroke();
        var imgdata1 = az_canvas1.toDataURL('load/azimuth1');
        azimuth1 = document.getElementById("azimuth1")
        azimuth1.src = imgdata1
        azimuth1.style.backgroundColor = "yellow";
        //azimuth moyen
        var az_canvasmoy = document.createElement("canvas");
        var ctx5 = az_canvasmoy.getContext("2d");
        ctx5.font = "140px Arial";
        ctx5.fillText(azimuth, 20, 110);
        ctx5.font = "60px Arial";
        ctx5.fillText("Moy", 110, 145);
        ctx5.stroke();
        var imgdatamoy = az_canvasmoy.toDataURL('load/azimuthmoy');
        azimuthmoy = document.getElementById("azimuthmoy")
        azimuthmoy.src = imgdatamoy
        azimuthmoy.style.backgroundColor = "yellow";

        //azimuthA
        var az_canvasa = document.createElement("canvas");
        var ctx7 = az_canvasa.getContext("2d");
        ctx7.font = "140px Arial";
        ctx7.fillText(azimuth, 20, 100);
        ctx7.font = "70px Arial";
        ctx7.fillText("A", 110, 150);
        ctx7.stroke();
        var imgdataa = az_canvasa.toDataURL('load/azimutha');
        azimutha = document.getElementById("azimutha")
        azimutha.src = imgdataa
        azimutha.style.backgroundColor = "yellow";

        //azimuthC
        var az_canvasc = document.createElement("canvas");
        var ctx6 = az_canvasc.getContext("2d");
        ctx6.font = "140px Arial";
        ctx6.fillText(azimuth, 20, 100);
        ctx6.font = "70px Arial";
        ctx6.fillText("C", 110, 150);
        ctx6.stroke();
        var imgdatac = az_canvasc.toDataURL('load/azimuthc');
        azimuthc = document.getElementById("azimuthc")
        azimuthc.src = imgdatac
        azimuthc.style.backgroundColor = "yellow";










    }

    function display_infos(){
        var firstcanvas = document.getElementById("c0");
        context1 = firstcanvas.getContext('2d');
        context1.font = "40px Arial";
        context1.clearRect(0, 0, firstcanvas.width, firstcanvas .height);
        context1.fillText(distance_totale.toFixed(2) + "  Km", 70, 40);
        context1.fillText(case_nb + "  WP", 70, 90);
        context1.fillText(fuel_wp + "  FUEL", 70, 140);
        }
    // Fonction pour créer un nouveau canvas lors du clic
    function createNewCanvas(distance_tt, distance, case_number, azim) {

        display_infos();
        var c = document.createElement("canvas");
        c.className = "dropzone";
        c.id = c_id_counter;
        c_id_counter +=1
        c.style.zIndex = "1";
        c.width = 610;
        c.height = 180;
        c.setAttribute("comment", azim)
        var ctx = c.getContext("2d");

        ctx.font = "50px Arial";
        ctx.fillText(distance_tt, 40, 100); // Texte au centre du canvas
        ctx.font = "20px Arial";
        ctx.fillText(case_number, 165, 177)
        ctx.font = "30px Arial";
        ctx.fillText(distance, 4, 175)
        var case1_left_case = ctx.rect(0,150, 100,30);
        var case2_left_case = ctx.rect(163,160, 70,30);
        var left_case = ctx.rect(0, 1, 202,180);
        var middle_case = ctx.rect(201, 1, 201,180);
        var right_case = ctx.rect(401,1, 210,180);

        ctx.stroke();

        var arrowStartX = 300;
        var arrowStartY = 120;
        var arrowControl1X = 300;
        var arrowControl1Y = 110;
        var arrowControl2X = 300;
        var arrowControl2Y = 65;
        var arrowEndX = 300;
        var arrowEndY = 35;

        //parra
        var arrowStartX1 = 300 + 10
        var arrowStartY1 = 120;
        var arrowControl1X1 = 300 +10;
        var arrowControl1Y1 = 110 ;
        var arrowControl2X1 = 300 +10;
        var arrowControl2Y1 = 65 ;
        var arrowEndX1 = 300 +10;
        var arrowEndY1 = 35;
        const arrowHeadSize = 15;


        function draw_control_point(context){
            context.beginPath();
            context.arc(arrowControl1X, arrowControl1Y, 5, 0, Math.PI * 2);
            context.fill();
            context.arc(arrowControl2X, arrowControl2Y, 5, 0, Math.PI * 2);
            context.fill();

        }


        function drawArrow(ct, type){
            ct.clearRect(201, 2, 198, 179);
            ct.lineWidth = 2;


            if(line_type =="offroad"){
                var ct1 = ct
                ct.setLineDash([]);
                ct.strokeStyle = "blue"

                ct.beginPath();
                ct.moveTo(arrowStartX, arrowStartY);
                ct.bezierCurveTo(arrowControl1X, arrowControl1Y, arrowControl2X, arrowControl2Y, arrowEndX, arrowEndY)
                ct.stroke();
                ct.beginPath();
                ct.moveTo(arrowEndX, arrowEndY);
                const angle = Math.atan2(arrowEndY - arrowControl2Y, arrowEndX - arrowControl2X);
                ct.lineTo(
                arrowEndX - arrowHeadSize * Math.cos(angle - Math.PI / 6),
                arrowEndY - arrowHeadSize * Math.sin(angle - Math.PI / 6)
                );
                ct.moveTo(arrowEndX, arrowEndY);
                ct.lineTo(
                arrowEndX - arrowHeadSize * Math.cos(angle + Math.PI / 6),
                arrowEndY - arrowHeadSize * Math.sin(angle + Math.PI / 6)
                );
                ct.lineTo(
                arrowEndX - arrowHeadSize * Math.cos(angle - Math.PI / 6),
                arrowEndY - arrowHeadSize * Math.sin(angle - Math.PI / 6)
                );
                ct.fillStyle = "blue";
                ct.fill()
                ct.stroke()
            }

            if(type == "track"){

                ct.beginPath();
                ct.strokeStyle = "blue"

                ct.setLineDash([3, 4]);
                ct.moveTo(arrowStartX, arrowStartY);
                ct.bezierCurveTo(arrowControl1X, arrowControl1Y, arrowControl2X, arrowControl2Y, arrowEndX, arrowEndY)
                ct.stroke();
                ct.beginPath();
                ct.moveTo(arrowEndX, arrowEndY);
                const angle = Math.atan2(arrowEndY - arrowControl2Y, arrowEndX - arrowControl2X);
                ct.lineTo(
                arrowEndX - arrowHeadSize * Math.cos(angle - Math.PI / 6),
                arrowEndY - arrowHeadSize * Math.sin(angle - Math.PI / 6)
                    );
                ct.moveTo(arrowEndX, arrowEndY);
                ct.lineTo(
                arrowEndX - arrowHeadSize * Math.cos(angle + Math.PI / 6),
                arrowEndY - arrowHeadSize * Math.sin(angle + Math.PI / 6)
                    );
                ct.lineTo(
                arrowEndX - arrowHeadSize * Math.cos(angle - Math.PI / 6),
                arrowEndY - arrowHeadSize * Math.sin(angle - Math.PI / 6)
                    );
                ct.fillStyle = "blue";
                ct.fill();
                ct.stroke()

            }


            ct.beginPath()
            ct.strokeStyle = "black"
            ct.setLineDash([]);
            ct.moveTo(300, 160);
            ct.lineTo(300, 120);
            ct.lineTo(315, 130);
            ct.arc(315, 130, 2, 0, 2 * Math.PI);
            ct.stroke();






        }

        function Arrow_control() {
            drawArrow(ctx, line_type);
            draw_control_point(ctx)

        function updateControlPoint1(x, y) {
            arrowControl1X = x;
            arrowControl1Y = y;
            arrowControl1X1 = x +10;
            arrowControl1Y1 = y +10;
            drawArrow(ctx3, line_type);
        }

        function updateControlPoint2(x, y) {
            arrowControl2X = x;
            arrowControl2Y = y;
            arrowControl2X1 = x +10;
            arrowControl2Y1 = y +10;
            drawArrow(ctx3, line_type);
        }

        function updateEndPoint(x, y) {
            arrowEndX = x;
            arrowEndY = y;
            arrowEndX1 = x +10;
            arrowEndY1 = y +10;
            drawArrow(ctx3, line_type);
        }

        c.addEventListener('mousedown', function(e) {
            const rect = c.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const distToControl1 = Math.sqrt((mouseX - arrowControl1X) ** 2 + (mouseY - arrowControl1Y) ** 2);
            const distToControl2 = Math.sqrt((mouseX - arrowControl2X) ** 2 + (mouseY - arrowControl2Y) ** 2);
            const distToEnd = Math.sqrt((mouseX - arrowEndX) ** 2 + (mouseY - arrowEndY) ** 2);

            if (distToControl1 <= 20) {
                c.addEventListener('mousemove', controlPoint1Drag);
            } else if (distToControl2 <= 20) {
                c.addEventListener('mousemove', controlPoint2Drag);
            } else if (distToEnd <= 20) {
                c.addEventListener('mousemove', endPointDrag);
            }
        });

       var limitx_min = 838
        var limitx_max = 1025
        function controlPoint1Drag(e) {
            const rect = c.getBoundingClientRect();
            if(e.clientX > limitx_min && e.clientX < limitx_max){
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                updateControlPoint1(mouseX, mouseY);
            }

        }

        function controlPoint2Drag(e) {
            const rect = c.getBoundingClientRect();
            if(e.clientX > limitx_min && e.clientX < limitx_max){
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                updateControlPoint2(mouseX, mouseY);
            }
        }

        function endPointDrag(e) {
            const rect = c.getBoundingClientRect();
            if(e.clientX > limitx_min && e.clientX < limitx_max){
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;
                updateEndPoint(mouseX, mouseY);
            }
        }

        c.addEventListener('mouseup', function() {
            c.removeEventListener('mousemove', controlPoint1Drag);
            c.removeEventListener('mousemove', controlPoint2Drag);
            c.removeEventListener('mousemove', endPointDrag);
        });


        }



        Arrow_control();







        c.onmousedown = function(event) {
                clicked_canvas = event.target;

                x_clicked = clicked_canvas.offsetLeft;
                y_clicked = clicked_canvas.offsetTop;

                ctx3 = clicked_canvas.getContext("2d")
                draw_control_point(ctx3)


                load_azimut_to_image(clicked_canvas)


            }






        document.getElementById('track').addEventListener('click', function() {
            line_type = "track"
            drawArrow(ctx3, "track")


            });

        document.getElementById('offroad').addEventListener('click', function() {
            line_type = "offroad"
            drawArrow(ctx3, "offroad")

            });


        document.getElementById('trail').addEventListener('click', function() {


            });

        document.getElementById('road').addEventListener('click', function() {

            });


        document.getElementById('hightway').addEventListener('click', function() {

            });










    var canvasContainer = document.getElementById("canvasContainer");


    //Ajout du nouveau canvas au conteneur

    canvasContainer.appendChild(c);
    }

function azimuth(a,b,c,d,{units:e="m",distancePrecision:f=0,formula:g="great-circle",bearingPrecision:h=0,directionPrecision:i=1}={}){var j=Number.prototype,k=Math.sqrt,l=Math.round,m=Math.cos,n=Math.sin,o=Math.atan2,p=Math.abs,r=Math.log,s=Math.tan,t=Math.PI;function u(a){return a*(t/180)}function v(a){return a*(180/t)}if(isNaN(a)||isNaN(c)||isNaN(b)||isNaN(d)||isNaN(h)||isNaN(i))throw new Error("Latitude/Longitude parameter is not a number!");if(90<p(a)||90<p(c)||180<p(b)||180<p(d))throw new Error("Latitude/Longitude parameter exceeding maximal value!");if(isNaN(f)||isNaN(h)||15<f||15<h)throw new Error("Precision parameter is not a number or exceeds it's maximum value of 15!");if(!["m","km","ft","yd","mi","nm"].includes(e))throw new Error("Units parameter type not supported!");if(!["great-circle","rhumb-line"].includes(g))throw new Error("Calculation formula type parameter not supported!");const w=6371009;j.round=function(a=0){let b=new Number(this.valueOf());return+(l(b+"e+"+a)+"e-"+a)};let q={};const x=function(a,b="m"){if("m"===b)return a;switch(b){case"km":return .001*a;break;case"ft":return 3.28084*a;break;case"yd":return 1.0936*a;break;case"mi":return 621371e-9*a;break;case"nm":return 539957e-9*a;break;default:return a;}}("rhumb-line"===g?function(a,b,c,d){if(a===c&&b===d)return 0;const e=u(a),f=u(c),g=u(a-c),h=u(b-d),i=r(s(t/4+f/2)/s(t/4+e/2)),j=1e-11<p(i)?g/i:m(e);p(h)>t&&(0<h?h=-(2*t-h):h=2*t+h);const l=k(g*g+j*j*h*h)*w;return l}(a,b,c,d):function(b,d,e,f){if(b===e&&d===f)return 0;const g=u(b),h=u(e),i=u(b-e),j=u(d-f),l=n(i/2)*n(i/2)+m(g)*m(h)*n(j/2)*n(j/2),a=2*o(k(l),k(1-l));return w*a}(a,b,c,d),e).round(f);q.distance=x,q.units=e;const y=0==x?"":("rhumb-line"===g?function(a,b,c,d){if(a===c&&b===d)return 0;const e=u(a),f=u(c);let g=u(d-b);const h=r(s(t/4+f/2)/s(t/4+e/2));p(g)>t&&(0<g?g=-(2*t-g):g=2*t+g);const i=o(g,h),j=(v(i)+360)%360;return j}(a,b,c,d):function(a,b,c,d){const e=u(a),f=u(c),g=u(d-b),h=n(g)*m(f),i=m(e)*n(f)-n(e)*m(f)*m(g),j=o(h,i),k=(v(j)+360)%360;return k}(a,b,c,d)).round(h);return q.bearing=y,q.formula=g,0!==i&&(q.direction=0==x?"":function(a,b){if(isNaN(a)||isNaN(b)){throw new Error("Parameter is not a number!")}if(0>a||360<a){throw new Error("Parameter outside of range!")}if(1>b||3<b){throw new Error("Parameter outside of range!")}let c=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],d=4;2===b&&(d=8),3===b&&(d=16);let e=360/d,f=c.length/d,g=l(a/e)*f;return(()=>c.length)&&(g=0),c[g]}(y,i)),q};


	const map = L.map('map').setView([48.2756, 2.10194], 10);



	const sat = L.tileLayer('http://{s}.google.com/vt?lyrs=s&x={x}&y={y}&z={z}',{
      maxZoom: 20,
      subdomains:['mt0','mt1','mt2','mt3']
      }).addTo(map);

	const sat2 = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
          {attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'});

	const baseLayers = {
        Google_Satelite: sat,
        Satelite: sat2,
      };



	function onMapClick(e) {
    if (window.event.ctrlKey == false) {
        var groupe = new L.layerGroup()
        groupe.addLayer(L.marker(e.latlng));
        points.push(e.latlng);
        groupe.addLayer(L.polyline(points, { color: 'blue' }));
        groupe.addTo(map)
        groupes.push(groupe)

        if (points.length >= 2) {
            direction = azimuth(points[points.length - 2]["lat"], points[points.length - 2]["lng"], points[points.length - 1]["lat"], points[points.length - 1]["lng"])
            orientations.push(direction)
            console.log(direction)
            distance_totale += direction["distance"] / 1000
            createNewCanvas(distance_totale.toFixed(2), (direction["distance"] / 1000).toFixed(2), case_nb, direction["bearing"])
            case_nb += 1
            l_canvas = document.querySelectorAll('.dropzone');
        }

    }

    if (window.event.ctrlKey) {
        points.pop(points.length - 1)
        last_canvas = l_canvas[(l_canvas.length - 1)]
        if(l_canvas.length != 0){
            last_canvas.remove()
        }

        groupes[groupes.length - 1].removeFrom(map)
        if(groupes.length == 1)
        {
            groupes.pop(0)
        }
        groupes.pop(groupes.length - 1)
        orientations.pop(orientations.length - 1)
        l_canvas = document.querySelectorAll('.dropzone');
    }


    groupes.forEach(groupe => {
        groupe.eachLayer(function (layer) {
            var index = groupes.indexOf(groupe);
            if(index == 0 && layer instanceof L.Marker){
                    layer.setIcon(L.icon({
                    iconUrl: './Symbols/marker-icon-green.png', // URL de l'icône avec la nouvelle couleur
                    iconSize: [25, 41], // Taille de l'icône (largeur, hauteur)
                    iconAnchor: [12, 41], // Point d'ancrage de l'icône (position du point d'ancrage par rapport au coin supérieur gauche de l'icône)
                    popupAnchor: [1, -34] // Point d'ancrage de la fenêtre contextuelle (position du point d'ancrage par rapport au coin supérieur gauche de l'icône)
                    }))};


            layer.on('click', function () {
                // Votre action à effectuer lorsque le marqueur est cliqué


                function dist(){
                    r = 0
                    if(index != 0){ r = ((direction["distance"] / 1000).toFixed(2))};
                    return r;
                }

                layer.bindPopup("WP : " + index +" / "+ dist() +" KM").openPopup();


            });
        });
    });
};

	map.on('click', onMapClick);










var objects = document.querySelectorAll('.clone');

function dragStart(event) {
    // Créer un clone de l'image
    var target = event.target;
    var clone = target.cloneNode(true); // Cloner l'élément
    clone.className = "clone";
    clone.style.zIndex = 1000;
    clone.style.position = 'absolute';
    clone.style.left = x_clicked +420 +"px";
    clone.style.top = y_clicked +30 +"px";
    clone.style.width = 50 + "px"
    clone.style.length = 50 + "px"
    // Ajouter le clone au document
    var container = document.getElementById("canvasContainer")
    container.appendChild(clone);


    // Mettre à jour la liste des clones
    objects = document.querySelectorAll('.clone');
}

// Define variables to track Shift key status
let isShiftPressed = false;
var rotate_on_left_side = true;
// Event listener for Shift key down
document.addEventListener('keydown', function(event) {
    if (event.key === 'Shift') {
        isShiftPressed = true;
    }
});

// Event listener for Shift key up
document.addEventListener('keyup', function(event) {
    if (event.key === 'Shift') {
        isShiftPressed = false;
    }
});

function drag() {
    objects.forEach(object => {
        object.onmousedown = function(event) {
            let shiftX = event.clientX - object.getBoundingClientRect().left;
            let shiftY = event.clientY - object.getBoundingClientRect().top;

            object.style.zIndex = 1000;
            document.body.append(object);

            moveAt(event.pageX, event.pageY);

            function moveAt(pageX, pageY) {
                // Apply movement only if Shift key is not pressed
                if (!isShiftPressed) {
                    object.style.left = pageX - shiftX + 'px';
                    object.style.top = pageY - shiftY + 'px';
                }
            }

            function onMouseMove(event) {
                moveAt(event.pageX, event.pageY);

                object.hidden = true;
                let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
                object.hidden = false;

                if (!elemBelow) return;

                let droppableBelow = elemBelow.closest('.droppable');

                 // Rotate the object based on the y position of the mouse if Shift key is pressed
                if (isShiftPressed) {
                        object.style.transform = "rotate(" + (event.clientY / window.innerHeight) * 360 + "deg)";
                    }
                // Check if the object id matches any of the specified ids
                if (object.id === "offroad_" || object.id === "track_" || object.id === "trail_" || object.id === "road_" || object.id === "highway_") {
                    if (event.pageX < 900 && rotate_on_left_side) {
                        object.style.transform = 'rotate(180deg)';
                        rotate_on_left_side = false;
                    }
                }
            }

            document.addEventListener('mousemove', onMouseMove);

            object.onmouseup = function() {
                document.removeEventListener('mousemove', onMouseMove);
                object.onmouseup = null;
            };

            // Supprimer le clone lorsqu'on fait Ctrl + clic
            object.onmousedown = function(event) {
                if (event.ctrlKey) {
                    object.remove();
                }
            };
        };

        object.ondragstart = function() {
            return false;
        };
    });
}


let im = document.querySelectorAll('.drag-el'); // Sélectionner tous les éléments avec la classe 'drag-el'

im.forEach(object => {
    object.onmousedown = function(event) {
        dragStart(event);
        drag();
    };
});


//import GPX

function chooseFile() {
    document.getElementById('fileInput').click();
  }

 document.getElementById('fileInput').addEventListener('change', function(e) {
    var file = e.target.files[0];
    if (file) {
      var reader = new FileReader();
      reader.onload = function(e) {
        var gpxData = e.target.result;
        displayGPX(gpxData);
      };
      reader.readAsText(file);
    }
  });

   function displayGPX(gpxData) {
    // Clear existing layers
    map.eachLayer(function(layer) {
      if (layer instanceof L.GPX) {
        map.removeLayer(layer);
      }
    });

    // Load and display GPX file
    new L.GPX(gpxData, {
      async: true,
      marker_options: {
        startIconUrl: '',
        endIconUrl: '',

      }
    }).on('loaded', function(e) {
      map.fitBounds(e.target.getBounds()); // Adjust map bounds to fit GPX track
    }).addTo(map);
  }


</script>

<div class="popup-container" id="popup">
  <div class="popup-content">
    <img id="logo" src="./Symbols/logo_blue.png">
    <p>Opensource Rally Roadbook Creator</p>
    <p id="contact_m">Contact : clementrg@proton.me</p>

    <h3>Instructions: </h3>
      <p>Place your markers or import a .gpx file</p>
      <p>Click on the Waypoints case for select it</p>
      <p>You can now drop images on the selected waypoint and change the way type with the buttons</p>
      <p>Ctrl+click for delete objects</p>
      <p>Shift+click and move on axe Y for rotate objects</p>
      <p>For print you can easily printscreen select the Roadbook and save to PDF</p>
      <p>Print adjustements : Papersize = A3, More Settings -> Custom Scale = 69% </p>






    <button onclick="closePopup()">Close</button>
  </div>
</div>
</body>
</html>
